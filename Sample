import IOKit.hid

func sendEMVStartCommand(to device: IOHIDDevice) -> IOReturn {
    let reportID: UInt8 = 0x02 // Example Report ID for EMV
    let reportType = kIOHIDReportTypeOutput // EMV commands often use output reports
    
    // Example EMV Start Command (refer to MagTek's documentation for specifics)
    let emvCommand: [UInt8] = [
        0x02, // STX (Start of Text)
        0x56, // 'V' - Start EMV command identifier
        0x30, 0x31, 0x30, 0x30, // Amount: "0100" (1.00 in cents)
        0x00  // ETX (End of Text)
    ]
    
    // Convert command to Data
    let reportData = Data(emvCommand)
    
    // Send the report
    let result = IOHIDDeviceSetReport(
        device,
        reportType,
        reportID,
        [UInt8](reportData),
        reportData.count
    )
    
    // Handle the result
    if result == kIOReturnSuccess {
        print("EMV Start Command sent successfully.")
    } else {
        print("Failed to send EMV Start Command: \(result)")
    }
    
    return result
}
